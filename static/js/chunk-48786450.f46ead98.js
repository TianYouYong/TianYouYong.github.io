(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-48786450"],{"0786":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-row",{attrs:{gutter:24}},[a("el-row",{staticClass:"headerBtnLine",attrs:{gutter:24}},[a("el-col",{staticClass:"clearfix"},[a("el-link",{staticClass:"pull-right mt10 mr20 go-back",attrs:{type:"primary"},on:{click:e.goBack}},[e._v(" 返回 - 远程控制")])],1)],1),e._v(" "),a("el-row",{staticClass:"diagnose_content mt-10",attrs:{gutter:24}},[a("el-col",{staticClass:"left",attrs:{span:12}},[a("el-form",{ref:"form",staticClass:"mt20 formBtLine",attrs:{model:e.form,rules:e.rules,"label-width":"120px"}},[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"诊断类型",prop:"diagnosisType"}},[a("el-select",{staticStyle:{width:"68%"},attrs:{clearable:""},model:{value:e.form.diagnosisType,callback:function(t){e.$set(e.form,"diagnosisType",t)},expression:"form.diagnosisType"}},e._l(e.diagnoseOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"控制器选择",prop:"channelNo"}},[a("el-select",{staticStyle:{width:"68%"},attrs:{clearable:""},model:{value:e.form.channelNo,callback:function(t){e.$set(e.form,"channelNo",t)},expression:"form.channelNo"}},e._l(e.controllerOptions,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"指令ID",prop:"fileName"}},[a("el-input",{staticStyle:{width:"68%"},attrs:{placeholder:"请选择ID文件",disabled:""},model:{value:e.form.fileName,callback:function(t){e.$set(e.form,"fileName",t)},expression:"form.fileName"}}),e._v(" "),a("upload",{attrs:{"file-type":"any","limit-size":10,"bt-plain":!0,"bt-size":"medium"},on:{getFile:e.getFile}})],1)],1)],1)],1),e._v(" "),a("el-col",{staticClass:"mt15 mb10"},[a("el-button",{attrs:{type:"primary",size:"mini",plain:"",disabled:e.multiple},on:{click:e.handleDelete}},[e._v("批量清除")]),e._v(" "),a("el-button",{staticClass:"pull-right",attrs:{type:"primary",size:"mini",plain:"",icon:"el-icon-refresh"},on:{click:function(t){e.getSnagList(),e.queryDiagnoseLog()}}},[e._v("手动刷新")])],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{data:e.snagList,"max-height":"350"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"ECU编号",align:"center",prop:"ecuNo","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s("ECU"+t.row.ecuNo||!1)+"\n              ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"故障码DTC",align:"center",prop:"dtcCode","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.dtcCode||"--")+"\n              ")]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",width:"180","class-name":"small-padding fixed-width"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("清除")])]}}])})],1),e._v(" "),a("pagination",{directives:[{name:"show",rawName:"v-show",value:e.total>0,expression:"total > 0"}],attrs:{total:e.total,page:e.queryParams.pageNo,limit:e.queryParams.pageSize},on:{"update:page":function(t){return e.$set(e.queryParams,"pageNo",t)},"update:limit":function(t){return e.$set(e.queryParams,"pageSize",t)},pagination:e.getSnagList}})],1),e._v(" "),a("el-col",{staticClass:"right",attrs:{span:12}},[a("div",{staticClass:"history_wrap"},e._l(e.diagnoseHistory,(function(t,i){return a("div",{key:i},[t.length?a("p",{staticClass:"text-primary"},[e._v("\n                "+e._s(t[0].createTime)+"\n              ")]):e._e(),e._v(" "),e._l(t,(function(t,i){return a("div",{key:i,staticClass:"content_wrap"},[a("p",{staticClass:"text-muted"},[e._v(e._s(t.log))])])}))],2)})),0)]),e._v(" "),a("el-col",{staticClass:"bottomLine",attrs:{span:24}})],1)],1),e._v(" "),a("div",{staticClass:"text-center mt20"},[a("el-button",{attrs:{type:"primary",loading:e.diagnLoading},on:{click:e.submitForm}},[e._v(e._s(e.diagnLoading?"诊断中...":"确 定"))]),e._v(" "),a("el-button",{on:{click:e.cancel}},[e._v("重 置")])],1)],1)},n=[],o=(a("7f7f"),a("ac6a"),a("456d"),a("7d4e")),r=a("8889"),s=a("b74d"),l={name:"RemoteDiagnose",components:{Upload:o["a"]},props:{},data:function(){var e=this;return{file:null,formData:new FormData,diagnoseOptions:Object.keys(this.ENUMS.DIAGNOSE_TYPE).map((function(t){return{value:t,label:e.ENUMS.DIAGNOSE_TYPE[t]}})),controllerOptions:Object.keys(this.ENUMS.CONTROLLER_TYPE).map((function(t){return{value:t,label:e.ENUMS.CONTROLLER_TYPE[t]}})),ids:[],multiple:!0,total:0,snagList:[],tableLoading:!1,diagnLoading:!1,diagnTimer:null,diagnTimerout:null,diagnoseHistory:[],form:{},rules:{diagnosisType:[{required:!0,message:"请选择诊断类型",trigger:"change"}],channelNo:[{required:!0,message:"请选择控制器",trigger:"change"}],fileName:[{required:!0,message:"ID文件不能为空",trigger:["blur","change"]}]},queryParams:{pageNo:1,pageSize:10,orderBy:"createTime",order:"desc"}}},created:function(){this.reset(),this.getSnagList(),this.queryDiagnoseLog()},methods:{getSnagList:function(){var e=this;this.tableLoading=!0,this.queryParams.deviceCode=this.$route.params.deviceCode,this.queryParams.projectCode=this.$route.params.projectCode,Object(s["f"])(this.queryParams).then((function(t){t&&200===t.code?(e.snagList=t.data.list,e.total=t.data.total,e.tableLoading=!1):e.tableLoading=!1}))},queryDiagnoseLog:function(){var e=this,t={projectCode:this.$route.params.projectCode,deviceCode:this.$route.params.deviceCode};Object(s["d"])(t).then((function(t){t&&200===t.code&&(e.diagnoseHistory=t.data)}))},handleSelectionChange:function(e){this.ids=e.map((function(e){return e.id})),this.multiple=!e.length},handleDelete:function(e){var t=this,a=(e.id?[e.id]:"")||this.ids,i=[];this.snagList.forEach((function(e){a.forEach((function(t){t===e.id&&i.push(e.dtcCode)}))})),this.$confirm('<div class="world-break">确认清除故障码为"'+i+'"的数据项吗？</div>',"提示",{dangerouslyUseHTMLString:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(s["c"])(a).then((function(e){if(e&&200===e.code){t.msgSuccess("清除成功");var a=Math.ceil((t.total-1)/t.queryParams.pageSize),i=t.queryParams.pageNo>a?a:t.queryParams.pageNo;t.queryParams.pageNo=i<1?1:i,t.getSnagList()}})).catch((function(e){t.msgError(e.data.message||"清除失败！")}))})).catch((function(){}))},getFile:function(e){console.log("file :>> ",e),e?(this.formData.set("file",e),this.formData.set("remark","file"),this.form.fileName=e.name):(this.formData.set("file",null),this.form.fileName="")},checkDiagnStatus:function(){var e=this,t={deviceCode:this.$route.params.deviceCode};Object(s["a"])(t).then((function(t){t&&200===t.code&&!0===t.data&&(e.$message.success("诊断完成"),clearInterval(e.diagnTimer),clearTimeout(e.diagnTimerout),e.diagnLoading=!1,e.getSnagList(),e.queryDiagnoseLog())}))},goBack:function(){this.$router.go(-1)},submitForm:function(){var e=this;this.$refs["form"].validate((function(t){if(t){var a={deviceCode:e.$route.params.deviceCode};Object(s["a"])(a).then((function(t){t&&200===t.code&&(!1===t.data?e.$message.error("此设备正在诊断中，请稍后重试！"):(e.diagnLoading=!0,Object(r["g"])(e.formData).then((function(t){t&&200===t.code&&(e.form.fileName=t.data.fileName,e.form.filePath=t.data.filePath,e.form.fileType=t.data.fileType,e.form.deviceCode=e.$route.params.deviceCode,e.form.projectCode=e.$route.params.projectCode,Object(s["g"])(e.form).then((function(t){t&&200===t.code&&(e.$message.success("终端正在诊断中..."),e.diagnTimer=setInterval((function(){e.checkDiagnStatus()}),5e3),e.diagnTimerout=setTimeout((function(){clearInterval(e.diagnTimer),clearTimeout(e.diagnTimerout),e.diagnLoading=!1,e.getSnagList(),e.queryDiagnoseLog()}),18e4))})).catch((function(t){e.$message.error(t.data.message||"操作失败"),e.diagnLoading=!1})))})).catch((function(t){e.$message.error("文件上传失败"),e.diagnLoading=!1}))))}))}}))},reset:function(){this.form={deviceCode:"",projectCode:"",diagnosisType:"",channelNo:"",fileName:"",filePath:"",fileType:"",IDFile:""},this.resetForm("form")},cancel:function(){this.reset()}}},c=l,u=(a("b18f"),a("2877")),d=Object(u["a"])(c,i,n,!1,null,"454d9c43",null);t["default"]=d.exports},"1d70":function(e,t,a){"use strict";a("2255")},2255:function(e,t,a){},"7c87":function(e,t,a){},"7d4e":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-upload",{ref:"upload",staticStyle:{display:"inline"},attrs:{action:"1","file-list":e.fileList,"show-file-list":e.showFileList,"on-change":e.handleChange,"before-upload":e.beforeUpload,"http-request":e.handleUpload,"on-remove":e.handleRemove}},[a("el-button",{attrs:{slot:"trigger",type:"primary",size:e.btSize,plain:e.btPlain},slot:"trigger"},[e._v(e._s(e.btContent))])],1)},n=[],o=(a("28a5"),a("7f7f"),a("c5f6"),{name:"Upload",props:{fileType:{default:"",type:String},limitSize:{default:0,type:Number},showFileList:{default:!1,type:Boolean},btPlain:{default:!1,type:Boolean},btSize:{default:"small",type:String},btContent:{default:"选择文件",type:String},iptLabel:{default:"",type:String}},data:function(){return{file:null,fileList:[]}},created:function(){},methods:{handleChange:function(e,t){t.length>1&&(this.fileList=[t[t.length-1]])},beforeUpload:function(e){console.log("beforeUpload :>> ",e);var t=/[`()|（）]/;if(t.test(e.name))return this.$message.error("文件名中不能有括号，请修改后重新上传！"),!1;var a=e.name.split(".").splice(-1)[0].toUpperCase()===this.fileType.toUpperCase(),i=e.size/1024/1024<this.limitSize;return"any"===this.fileType&&(a=!0),a||this.$message.error("上传文件必须是".concat(this.fileType.toUpperCase(),"格式 !")),i||this.$message.error("上传文件大小不能超过".concat(this.limitSize,"MB !")),a&&i},handleUpload:function(e){this.file=e.file,this.$emit("getFile",this.file,this.iptLabel)},handleRemove:function(e,t){this.file=null,this.$emit("getFile",this.file,"")}}}),r=o,s=(a("1d70"),a("2877")),l=Object(s["a"])(r,i,n,!1,null,"c49edf50",null);t["a"]=l.exports},8889:function(e,t,a){"use strict";a.d(t,"g",(function(){return o})),a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return s})),a.d(t,"e",(function(){return l})),a.d(t,"f",(function(){return c})),a.d(t,"c",(function(){return u})),a.d(t,"d",(function(){return d}));var i=a("b775"),n=(a("24bf"),a("f121"));function o(e){return Object(i["a"])({url:n["a"].API_FILE+"/file/upload/single",method:"post",data:e})}function r(e){return Object(i["a"])({url:n["a"].API_FILE+"/file-manage",method:"get",params:e})}function s(e){return Object(i["a"])({url:n["a"].API_FILE+"/device-config",method:"get",params:e})}function l(e){return Object(i["a"])({url:n["a"].API_MONIT+"/send-device",method:"post",data:e})}function c(e){return Object(i["a"])({url:n["a"].API_MONIT+"/send-device/again",method:"post",data:e})}function u(e){return Object(i["a"])({url:n["a"].API_FILE+"/device-file-upload/lastSendConfig",method:"get",params:e})}function d(e){return Object(i["a"])({url:n["a"].API_FILE+"/device-control/restart",method:"post",data:e})}},b18f:function(e,t,a){"use strict";a("7c87")},b74d:function(e,t,a){"use strict";a.d(t,"h",(function(){return o})),a.d(t,"e",(function(){return r})),a.d(t,"b",(function(){return s})),a.d(t,"f",(function(){return l})),a.d(t,"d",(function(){return c})),a.d(t,"g",(function(){return u})),a.d(t,"a",(function(){return d})),a.d(t,"c",(function(){return f}));var i=a("b775"),n=a("f121");function o(e){return Object(i["a"])({url:n["a"].API_FILE+"/terminalUpgrade/upgrade",method:"post",data:e})}function r(e){return Object(i["a"])({url:n["a"].API_FILE+"/terminalUpgradeLog/upgradeLogs",method:"post",data:e})}function s(e){return Object(i["a"])({url:n["a"].API_FILE+"/terminalUpgrade/upgradeStatus",method:"post",data:e})}function l(e){return Object(i["a"])({url:n["a"].API_FILE+"/dtcDiagnosis/diagnosisResultQuery",method:"post",data:e})}function c(e){return Object(i["a"])({url:n["a"].API_FILE+"/dtcDiagnosis/diagnosisLogQuery",method:"post",data:e})}function u(e){return Object(i["a"])({url:n["a"].API_FILE+"/dtcDiagnosis/diagnosis",method:"post",data:e})}function d(e){return Object(i["a"])({url:n["a"].API_FILE+"/dtcDiagnosis/diagnosisFinished",method:"get",params:e})}function f(e){return Object(i["a"])({url:n["a"].API_FILE+"/dtcDiagnosis/clearDtcCode",method:"post",data:e})}}}]);