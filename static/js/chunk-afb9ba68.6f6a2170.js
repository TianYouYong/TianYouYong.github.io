(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-afb9ba68"],{"1d70":function(e,t,r){"use strict";r("2255")},2255:function(e,t,r){},"24b4":function(e,t,r){"use strict";r.r(t);var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-container"},[r("el-row",{attrs:{gutter:24}},[r("el-row",{staticClass:"headerBtnLine",attrs:{gutter:24}},[r("el-col",{staticClass:"clearfix"},[r("el-link",{staticClass:"pull-right mt10 mr20 go-back",attrs:{type:"primary"},on:{click:e.goBack}},[e._v(" 返回 - 远程控制")])],1)],1),e._v(" "),r("el-row",{staticClass:"refresh_content mt-10",attrs:{gutter:24}},[r("el-col",{staticClass:"left",attrs:{span:12}},[r("el-form",{ref:"form",staticClass:"mt20",attrs:{model:e.form,rules:e.rules,"label-width":"120px"}},[r("el-row",[r("el-col",{attrs:{span:22,offset:1}},[r("el-form-item",{attrs:{label:"版本号",prop:"version"}},[r("el-input",{staticStyle:{width:"66%"},attrs:{placeholder:"请输入版本号"},model:{value:e.form.version,callback:function(t){e.$set(e.form,"version",t)},expression:"form.version"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:22,offset:1}},[r("el-form-item",{attrs:{label:"制造商ID",prop:"manufacturerId"}},[r("el-input",{staticStyle:{width:"66%"},attrs:{placeholder:"请输入制造商ID"},model:{value:e.form.manufacturerId,callback:function(t){e.$set(e.form,"manufacturerId",t)},expression:"form.manufacturerId"}})],1)],1),e._v(" "),r("el-col",{attrs:{span:22,offset:1}},[r("el-form-item",{attrs:{label:"刷写类型",prop:"upgradeType"}},[r("el-select",{staticStyle:{width:"66%"},attrs:{clearable:""},model:{value:e.form.upgradeType,callback:function(t){e.$set(e.form,"upgradeType",t)},expression:"form.upgradeType"}},e._l(e.refreshOptions,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:Number(e.value)}})})),1)],1)],1),e._v(" "),r("el-col",{attrs:{span:22,offset:1}},[r("el-form-item",{attrs:{label:"刷写文件",prop:"freshFile"}},[r("el-input",{staticStyle:{width:"66%"},attrs:{placeholder:"请选择刷写文件",disabled:""},model:{value:e.form.freshFile,callback:function(t){e.$set(e.form,"freshFile",t)},expression:"form.freshFile"}}),e._v(" "),r("upload",{attrs:{"file-type":"any","limit-size":500,"bt-plain":!0,"bt-size":"medium","ipt-label":"freshFile"},on:{getFile:e.getFile}})],1)],1)],1)],1)],1),e._v(" "),r("el-col",{staticClass:"right",attrs:{span:12}},[r("div",{staticClass:"history_wrap"},e._l(e.refreshHistory,(function(t,i){return r("div",{key:i},[t.length?r("p",{staticClass:"text-primary"},[e._v("\n                "+e._s(t[0].createTime)+"\n              ")]):e._e(),e._v(" "),e._l(t,(function(t,i){return r("div",{key:i,staticClass:"content_wrap"},[r("p",{staticClass:"text-muted"},[e._v(e._s(t.result))])])}))],2)})),0)]),e._v(" "),r("el-col",{staticClass:"bottomLine",attrs:{span:24}})],1)],1),e._v(" "),r("div",{staticClass:"text-center mt20"},[r("el-button",{attrs:{type:"primary",loading:e.refreshLoading},on:{click:e.submitForm}},[e._v(e._s(e.refreshLoading?e.loadingTitle:"确 定")+"\n      ")]),e._v(" "),r("el-button",{on:{click:e.cancel}},[e._v("重 置")])],1)],1)},a=[],o=(r("7f7f"),r("ac6a"),r("456d"),r("7d4e")),s=r("8889"),n=r("b74d"),l={name:"RemoteRefresh",components:{Upload:o["a"]},props:{},data:function(){var e=this;return{projectCode:void 0,deviceCode:void 0,file:null,formData:new FormData,refreshOptions:Object.keys(this.ENUMS.REFRESH_TYPE).map((function(t){return{value:t,label:e.ENUMS.REFRESH_TYPE[t]}})),refreshHistory:[{date:"2021-10-12 15:13",content:[{items:"配置下发完成..."},{items:"刷写中..."},{items:"xxxx..."},{items:"刷写完成"}]},{date:"2021-10-12 15:20",content:[{items:"配置下发完成..."},{items:"刷写中..."},{items:"xxxx..."},{items:"刷写完成"}]}],refreshTimer:null,refreshTimerout:null,refreshLoading:!1,loadingTitle:"",form:{deviceCode:"",projectCode:"",version:"",manufacturerId:"",freshFile:"",fileName:"",filePath:"",fileType:""},rules:{version:[{required:!0,message:"版本号不能为空",trigger:"blur"}],manufacturerId:[{required:!0,message:"制造商ID不能为空",trigger:"blur"},{pattern:/^[0-9a-zA-Z]{5}$/,message:"请输入5位数字或字母",trigger:"blur"}],upgradeType:[{required:!0,message:"请选择刷写类型",trigger:"change"}],freshFile:[{required:!0,message:"刷写文件不能为空",trigger:["blur","change"]}]}}},created:function(){this.reset(),this.projectCode=this.$route.params.projectCode,this.deviceCode=this.$route.params.deviceCode,this.queryRefreshLog()},methods:{queryRefreshLog:function(){var e=this,t={projectCode:this.projectCode,deviceCode:this.deviceCode};Object(n["e"])(t).then((function(t){console.log("res :>> refreshHistory",t),t&&200===t.code&&(e.refreshHistory=t.data)}))},goBack:function(){this.$router.go(-1)},getFile:function(e,t){e?(t&&(this.form[t]=e.name),this.formData.set("file",e),this.formData.set("remark","file"),this.formData.set("path","config"),this.form.freshFile=e.name):(this.formData.set("file",null),this.form.freshFile="")},checkRefreshStatus:function(){var e=this,t={deviceCode:this.deviceCode,projectCode:this.projectCode};Object(n["b"])(t).then((function(t){t&&200===t.code&&!0===t.data&&(e.$message.success("刷写完成"),clearInterval(e.refreshTimer),clearTimeout(e.refreshTimerout),e.refreshLoading=!1,e.loadingTitle="",e.queryRefreshLog())}))},submitForm:function(){var e=this;console.log("deviceCode is ",this.deviceCode),this.formData.set("path","config/"+this.deviceCode),this.$refs["form"].validate((function(t){if(t){var r={deviceCode:e.deviceCode,projectCode:e.projectCode};Object(n["b"])(r).then((function(t){t&&200===t.code&&(!1===t.data?e.$message.error("此设备正在刷写中，请稍后重试！"):(e.refreshLoading=!0,e.loadingTitle="文件上传中...",Object(s["g"])(e.formData).then((function(t){t&&200===t.code&&(e.form.fileName=t.data.fileName,e.form.filePath=t.data.filePath,e.form.fileType=t.data.fileType,e.form.deviceCode=e.deviceCode,e.form.projectCode=e.projectCode,Object(n["h"])(e.form).then((function(t){t&&200===t.code&&(e.loadingTitle="刷写中...",e.$message.success("终端正在刷写中..."),e.refreshTimer=setInterval((function(){console.log("刷写中 :>> "),e.checkRefreshStatus()}),5e3),e.refreshTimerout=setTimeout((function(){clearInterval(e.refreshTimer),clearTimeout(e.refreshTimerout),e.refreshLoading=!1,e.queryRefreshLog()}),18e4))})).catch((function(t){e.$message.error(t.data.message||"操作失败"),e.refreshLoading=!1,e.loadingTitle=""})))})).catch((function(t){e.$message.error("文件上传失败"),e.refreshLoading=!1,e.loadingTitle=""}))))}))}}))},reset:function(){this.resetForm("form")},cancel:function(){this.reset()}}},c=l,u=(r("ed77"),r("2877")),f=Object(u["a"])(c,i,a,!1,null,"788263b8",null);t["default"]=f.exports},"7d4e":function(e,t,r){"use strict";var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-upload",{ref:"upload",staticStyle:{display:"inline"},attrs:{action:"1","file-list":e.fileList,"show-file-list":e.showFileList,"on-change":e.handleChange,"before-upload":e.beforeUpload,"http-request":e.handleUpload,"on-remove":e.handleRemove}},[r("el-button",{attrs:{slot:"trigger",type:"primary",size:e.btSize,plain:e.btPlain},slot:"trigger"},[e._v(e._s(e.btContent))])],1)},a=[],o=(r("28a5"),r("7f7f"),r("c5f6"),{name:"Upload",props:{fileType:{default:"",type:String},limitSize:{default:0,type:Number},showFileList:{default:!1,type:Boolean},btPlain:{default:!1,type:Boolean},btSize:{default:"small",type:String},btContent:{default:"选择文件",type:String},iptLabel:{default:"",type:String}},data:function(){return{file:null,fileList:[]}},created:function(){},methods:{handleChange:function(e,t){t.length>1&&(this.fileList=[t[t.length-1]])},beforeUpload:function(e){console.log("beforeUpload :>> ",e);var t=/[`()|（）]/;if(t.test(e.name))return this.$message.error("文件名中不能有括号，请修改后重新上传！"),!1;var r=e.name.split(".").splice(-1)[0].toUpperCase()===this.fileType.toUpperCase(),i=e.size/1024/1024<this.limitSize;return"any"===this.fileType&&(r=!0),r||this.$message.error("上传文件必须是".concat(this.fileType.toUpperCase(),"格式 !")),i||this.$message.error("上传文件大小不能超过".concat(this.limitSize,"MB !")),r&&i},handleUpload:function(e){this.file=e.file,this.$emit("getFile",this.file,this.iptLabel)},handleRemove:function(e,t){this.file=null,this.$emit("getFile",this.file,"")}}}),s=o,n=(r("1d70"),r("2877")),l=Object(n["a"])(s,i,a,!1,null,"c49edf50",null);t["a"]=l.exports},8889:function(e,t,r){"use strict";r.d(t,"g",(function(){return o})),r.d(t,"a",(function(){return s})),r.d(t,"b",(function(){return n})),r.d(t,"e",(function(){return l})),r.d(t,"f",(function(){return c})),r.d(t,"c",(function(){return u})),r.d(t,"d",(function(){return f}));var i=r("b775"),a=(r("24bf"),r("f121"));function o(e){return Object(i["a"])({url:a["a"].API_FILE+"/file/upload/single",method:"post",data:e})}function s(e){return Object(i["a"])({url:a["a"].API_FILE+"/file-manage",method:"get",params:e})}function n(e){return Object(i["a"])({url:a["a"].API_FILE+"/device-config",method:"get",params:e})}function l(e){return Object(i["a"])({url:a["a"].API_MONIT+"/send-device",method:"post",data:e})}function c(e){return Object(i["a"])({url:a["a"].API_MONIT+"/send-device/again",method:"post",data:e})}function u(e){return Object(i["a"])({url:a["a"].API_FILE+"/device-file-upload/lastSendConfig",method:"get",params:e})}function f(e){return Object(i["a"])({url:a["a"].API_FILE+"/device-control/restart",method:"post",data:e})}},"8a5b":function(e,t,r){},b74d:function(e,t,r){"use strict";r.d(t,"h",(function(){return o})),r.d(t,"e",(function(){return s})),r.d(t,"b",(function(){return n})),r.d(t,"f",(function(){return l})),r.d(t,"d",(function(){return c})),r.d(t,"g",(function(){return u})),r.d(t,"a",(function(){return f})),r.d(t,"c",(function(){return d}));var i=r("b775"),a=r("f121");function o(e){return Object(i["a"])({url:a["a"].API_FILE+"/terminalUpgrade/upgrade",method:"post",data:e})}function s(e){return Object(i["a"])({url:a["a"].API_FILE+"/terminalUpgradeLog/upgradeLogs",method:"post",data:e})}function n(e){return Object(i["a"])({url:a["a"].API_FILE+"/terminalUpgrade/upgradeStatus",method:"post",data:e})}function l(e){return Object(i["a"])({url:a["a"].API_FILE+"/dtcDiagnosis/diagnosisResultQuery",method:"post",data:e})}function c(e){return Object(i["a"])({url:a["a"].API_FILE+"/dtcDiagnosis/diagnosisLogQuery",method:"post",data:e})}function u(e){return Object(i["a"])({url:a["a"].API_FILE+"/dtcDiagnosis/diagnosis",method:"post",data:e})}function f(e){return Object(i["a"])({url:a["a"].API_FILE+"/dtcDiagnosis/diagnosisFinished",method:"get",params:e})}function d(e){return Object(i["a"])({url:a["a"].API_FILE+"/dtcDiagnosis/clearDtcCode",method:"post",data:e})}},ed77:function(e,t,r){"use strict";r("8a5b")}}]);